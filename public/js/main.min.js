const errTopicExists="Topic already exists",errTopicLong="Topic is too long",errNoTopic="No topic entered",errNoNoteTopic="Please select a topic from the navigation bar first",errMicPermDenied="Allow the use of microphone to record a voice note",errPasswordUnmatch="Passwords do not match",errPasswordShort="Password must be at least 8 characters long",bread=document.querySelector(".bread"),burgers=document.querySelectorAll(".burger"),burgerMiddle=document.querySelector(".burger-middle"),navBar=document.querySelector(".nav-bar"),topicSection=document.querySelector(".topic-section"),addTopic=document.querySelector(".add-topic"),topicPopup=document.querySelector(".topic-popup"),topicPopupText=document.querySelector(".topic-popup__text"),topicPopupOK=document.querySelector(".popup-btn__ok"),topicPopupCancel=document.querySelector(".popup-btn__cancel"),newTopicPopup=document.querySelector(".new-topic-popup"),newTopicPopupText=document.querySelector(".new-topic-popup__text"),newTopicPopupOK=document.querySelector(".new-topic-popup-btn__ok"),newTopicPopupCancel=document.querySelector(".new-topic-popup-btn__cancel"),overlay=document.querySelector(".overlay"),errorSuccess=document.querySelector(".error-success"),errorSuccessMesg=document.querySelector(".error-success__mesg"),errorSuccessClose=document.querySelector(".error-success__close"),manipulateNotes=document.querySelector(".manipulate-notes"),notesContainer=document.querySelector(".notes-container"),addTextNotes=document.querySelector(".add-text-notes-container a"),addVoiceNotes=document.querySelector(".add-voice-notes-container a"),deleteTopic=document.querySelector(".delete-topics-container a"),editTopic=document.querySelector(".edit-topics-container a"),notesForm=document.querySelector(".text-notes-form"),deleteNote=document.querySelectorAll(".delete-note"),editNote=document.querySelectorAll(".edit-note"),audioPlayerContainers=document.querySelectorAll(".audio-player-container"),accountChangeUsername=document.querySelector(".account-changeusername"),accountChangePassword=document.querySelector(".account-changepassword"),changeUsernamePopup=document.querySelector(".changeusername-popup"),changePasswordPopup=document.querySelector(".changepassword-popup"),usernamePopupCancel=document.querySelector(".username-popup-btn__cancel"),usernamePopupText=document.querySelector(".changeusername-popup__text"),passwordPopupCancel=document.querySelector(".password-popup-btn__cancel"),passwordPopupText=document.querySelectorAll(".changepassword-popup input");let mediaRecorder,audioURL,mediaRecorder_chunks=[];errorSuccess.classList.contains("close")||[manipulateNotes,notesContainer,topicPopup,navBar,bread].forEach(a=>{a.style.pointerEvents="none",a.style.userSelect="none"});function convTime(a){return isFinite(a)?3600>a?new Date(1e3*a).toISOString().substr(14,5):new Date(1e3*a).toISOString().substr(11,8):a}function removeWhitespace(a){return null===a||void 0===a?void 0:a.toString().trim()}function createTextNoteTopic(a){let b=document.querySelector(".notes-topic"),c=document.createElement("p");c.innerText=a;let d=document.createElement("div");d.classList.add("notes-topic"),d.appendChild(c),notesContainer.replaceChild(d,b),bread.click()}function createTopic(a){let b=document.createElement("a");b.setAttribute("href",`/topics/topic/${encodeURIComponent(a)}`),b.innerText=a;let c=document.createElement("div");c.classList.add("topic"),c.appendChild(b),topicSection.appendChild(c),axios.post("/topics/savetopic",{topicName:a})}function saveEditedTopic(a){let b=document.querySelector(".notes-topic p").innerText;axios.post("/topics/savetopic",{oldTopicName:b,topicName:a}).then(b=>{201===b.status&&window.location.replace(`/topics/topic/${a}`)})}function createErrorSuccess(a){errorSuccessMesg.innerText=removeWhitespace(a),errorSuccessClose.click()}function createTextNote(){let a=document.querySelector(".notes-topic p").innerText;if(""===a||null===a)return void createErrorSuccess(errNoNoteTopic);let b=document.querySelector(".text-notes-form"),c=document.createElement("form");c.setAttribute("method","post"),c.setAttribute("action",window.location.pathname),c.classList.add("text-notes-form");let d=document.createElement("input");d.setAttribute("name","topic-name"),d.setAttribute("required","true"),d.value=a,d.style.display="none";let e=document.createElement("div");e.classList.add("entry-name-container");let f=document.createElement("label");f.setAttribute("for","entry-name"),f.innerText="Entry name:",f.classList.add("entry-name-label");let g=document.createElement("input");g.setAttribute("name","entry-name"),g.setAttribute("required","true"),g.classList.add("entry-name"),e.append(f,g);let h=document.createElement("textarea");h.setAttribute("name","text-note-entry");let i=document.createElement("div");i.classList.add("text-notes-button-container");let j=document.createElement("button");j.classList.add("notes-cancel"),j.innerText="Cancel";let k=document.createElement("button");k.setAttribute("type","submit"),k.classList.add("notes-save"),k.innerText="Save",i.append(j,k),c.append(d,e,h,i),notesContainer.replaceChild(c,b),CKEDITOR.replace("text-note-entry"),window.scroll(c.offsetLeft,c.offsetTop),j.addEventListener("click",a=>{a.preventDefault();let b=document.createElement("form");b.setAttribute("method","post"),b.setAttribute("action",window.location.pathname),b.classList.add("text-notes-form"),notesContainer.replaceChild(b,c)}),k.addEventListener("click",()=>{g.value=removeWhitespace(g.value)})}function createVoiceNote(){let a=document.querySelector(".notes-topic p").innerText;if(""===a||null===a)return void createErrorSuccess(errNoNoteTopic);let b=document.querySelector(".voice-notes-form"),c=document.createElement("form");c.setAttribute("method","post"),c.setAttribute("action",window.location.pathname),c.classList.add("voice-notes-form");let d=document.createElement("input");d.setAttribute("name","topic-name"),d.setAttribute("required","true"),d.value=a,d.style.display="none";let e=document.createElement("div");e.classList.add("entry-name-container");let f=document.createElement("label");f.setAttribute("for","entry-name"),f.innerText="Entry name:",f.classList.add("entry-name-label");let g=document.createElement("input");g.setAttribute("name","entry-name"),g.setAttribute("required","true"),g.classList.add("entry-name"),e.append(f,g);let h=document.querySelector(".audio-entry-container"),i=document.createElement("div");i.classList.add("audio-entry-container");let j=document.createElement("div");j.classList.add("recording-container");let k=document.createElement("button");k.classList.add("audio-record-button"),k.appendChild(document.createElement("div"));let l=document.createElement("p");l.classList.add("recording-info"),l.innerText="Start recording";let m=document.createElement("button");m.classList.add("notes-cancel"),m.innerText="Cancel",j.append(k,l),i.append(e,j,m),c.append(d,i),notesContainer.replaceChild(c,b),window.scroll(c.offsetLeft,c.offsetTop),k.addEventListener("click",async a=>{if(a.preventDefault(),k.classList.toggle("recording"),k.classList.contains("recording")){l.innerText="Please wait...";try{let a=await navigator.mediaDevices.getUserMedia({video:!1,audio:!0});l.innerText="Stop recording",mediaRecorder=new MediaRecorder(a),mediaRecorder.start(),mediaRecorder.addEventListener("dataavailable",a=>{mediaRecorder_chunks.push(a.data)})}catch(a){console.error(a),j.remove(),createErrorSuccess(errMicPermDenied)}}else mediaRecorder.stop(),l.innerText="Please wait...",setTimeout(()=>{audioBlob=mediaRecorder_chunks.pop(),audioURL=window.URL.createObjectURL(audioBlob);let a=document.createElement("div");a.classList.add("audio-actions-container");let b=document.createElement("audio");b.classList.add("audio-notes-entry"),b.controls=!0,b.src=audioURL;let c=document.createElement("div");c.classList.add("audio-actions__btns");let d=document.createElement("button");d.classList.add("audio-btn__discard","btn"),d.innerText="Discard";let e=document.createElement("button");e.setAttribute("type","submit"),e.classList.add("audio-btn__save","btn"),e.innerText="Save",c.append(d,e),a.append(b,c),i.replaceChild(a,j),e.addEventListener("click",()=>{g.value=removeWhitespace(g.value)}),d.addEventListener("click",a=>{a.preventDefault(),audioURL&&window.URL.revokeObjectURL(audioURL),addVoiceNotes.click()})},350),c.addEventListener("submit",a=>{a.preventDefault();let b=new FormData(c);b.append("voice-note-entry",audioBlob),axios.post(window.location.pathname,b).then(()=>{window.location.reload(!0)})})}),m.addEventListener("click",a=>{a.preventDefault(),mediaRecorder&&"inactive"!==mediaRecorder.state&&mediaRecorder.stop(),setTimeout(()=>mediaRecorder_chunks.length=0,500),audioURL&&window.URL.revokeObjectURL(audioURL);let b=document.createElement("form");b.setAttribute("method","post"),b.setAttribute("action",window.location.pathname),b.classList.add("voice-notes-form"),notesContainer.replaceChild(b,c)})}bread.addEventListener("click",()=>{if(navBar.classList.toggle("open"),bread.classList.toggle("open"),burgers.forEach(a=>a.classList.toggle("open")),burgerMiddle.classList.contains("open")){let a=document.createElement("div"),b=document.createElement("div");for(let c of[a,b])c.style.height="0.25em",c.style.width="1.5em",c.style.borderRadius="1px",c.style.backgroundColor="var(--primary-color)",c.style.position="absolute";burgerMiddle.style.display="flex",burgerMiddle.style.flexDirection="column",burgerMiddle.style.alignItems="center",burgerMiddle.style.justifyContent="center",burgerMiddle.style.position="relative",setTimeout(()=>{burgerMiddle.appendChild(a),burgerMiddle.appendChild(b),a.style.transform="rotate(45deg)",b.style.transform="rotate(-45deg)"},500)}else document.querySelectorAll(".burger-middle div").forEach(a=>burgerMiddle.removeChild(a))}),errorSuccessClose.addEventListener("click",()=>{errorSuccessClose.classList.toggle("close"),errorSuccess.classList.toggle("close"),errorSuccess.classList.contains("close")?[changePasswordPopup,manipulateNotes,notesContainer,topicPopup,newTopicPopup,navBar,bread].forEach(a=>{a.style.pointerEvents="unset",a.style.userSelect="auto"}):[changePasswordPopup,manipulateNotes,notesContainer,topicPopup,newTopicPopup,navBar,bread].forEach(a=>{a.style.pointerEvents="none",a.style.userSelect="none"})}),addTopic.addEventListener("click",a=>{a.preventDefault(),topicPopup.style.transform="translate(-50%,-50%) scale(1)",overlay.style.display="unset",bread.style.pointerEvents="none"}),topicPopupText.addEventListener("keypress",a=>{13===a.keyCode&&topicPopupOK.click()}),topicPopupCancel.addEventListener("click",a=>{a.preventDefault(),topicPopupText.value="",topicPopup.style.transform="translate(-50%,-50%) scale(0)",overlay.style.display="none",bread.style.pointerEvents="unset"}),topicPopupOK.addEventListener("click",a=>{a.preventDefault();let b=removeWhitespace(topicPopupText.value);if(topicPopupText.value="",""===b||null===b)return void createErrorSuccess(errNoTopic);for(let c of document.querySelectorAll(".topic a"))if(c.innerText===b)return void createErrorSuccess(errTopicExists);return 26<b.length?void createErrorSuccess(errTopicLong):void(createTopic(b),topicPopup.style.transform="translate(-50%,-50%) scale(0)",overlay.style.display="none",bread.style.pointerEvents="unset")}),newTopicPopupText.addEventListener("keypress",a=>{13===a.keyCode&&newTopicPopupOK.click()}),newTopicPopupCancel.addEventListener("click",a=>{a.preventDefault(),newTopicPopupText.value="",newTopicPopup.style.transform="translate(-50%,-50%) scale(0)",overlay.style.display="none",bread.style.pointerEvents="unset"}),newTopicPopupOK.addEventListener("click",a=>{a.preventDefault();let b=removeWhitespace(newTopicPopupText.value);if(newTopicPopupText.value="",""===b||null===b)return void createErrorSuccess(errNoTopic);for(let c of document.querySelectorAll(".topic a"))if(c.innerText===b)return void createErrorSuccess(errTopicExists);return 26<b.length?void createErrorSuccess(errTopicLong):void(newTopicPopup.style.transform="translate(-50%,-50%) scale(0)",overlay.style.display="none",bread.style.pointerEvents="unset",saveEditedTopic(b))}),accountChangeUsername.addEventListener("click",a=>{a.preventDefault(),changeUsernamePopup.style.transform="translate(-50%, -50%) scale(1)",overlay.style.display="unset",bread.style.pointerEvents="none"}),accountChangePassword.addEventListener("click",a=>{a.preventDefault(),overlay.style.display="unset",changePasswordPopup.style.transform="translate(-50%, -50%) scale(1)",bread.style.pointerEvents="none"}),usernamePopupCancel.addEventListener("click",a=>{a.preventDefault(),usernamePopupText.value="",changeUsernamePopup.style.transform="translate(-50%,-50%) scale(0)",overlay.style.display="none",bread.style.pointerEvents="unset"}),passwordPopupCancel.addEventListener("click",a=>{a.preventDefault(),passwordPopupText.forEach(a=>{a.value="",a.style.boxShadow="0 0 3px 2px var(--accent-color)"}),changePasswordPopup.style.transform="translate(-50%,-50%) scale(0)",overlay.style.display="none",bread.style.pointerEvents="unset"}),changePasswordPopup.addEventListener("submit",a=>{let b=passwordPopupText[1],c=passwordPopupText[2];b.value===c.value?8>b.value.length&&(b.style.boxShadow="0 0 8px 3px red",c.style.boxShadow="0 0 8px 3px red",createErrorSuccess(errPasswordShort),a.preventDefault()):(b.style.boxShadow="0 0 8px 3px red",c.style.boxShadow="0 0 8px 3px red",createErrorSuccess(errPasswordUnmatch),a.preventDefault())}),addTextNotes.addEventListener("click",a=>{a.preventDefault(),createTextNote()}),addVoiceNotes.addEventListener("click",a=>{a.preventDefault(),createVoiceNote()}),deleteTopic.addEventListener("click",a=>{a.preventDefault();let b=document.querySelector(".notes-topic p").innerText;if(""===b||null===b)return void createErrorSuccess(errNoNoteTopic);let c=Array.from(document.querySelectorAll(".topic a")),d=c.filter(a=>a.innerText===b).pop();axios.post("/topics/deletetopic",{topicName:b}).then(()=>{d.remove(),window.location.replace("/home")})}),editTopic.addEventListener("click",a=>{a.preventDefault();let b=document.querySelector(".notes-topic p").innerText;return""===b||null===b?void createErrorSuccess(errNoNoteTopic):void(newTopicPopup.style.transform="translate(-50%,-50%) scale(1)",overlay.style.display="unset",bread.style.pointerEvents="none")}),deleteNote&&deleteNote.forEach(a=>{a.addEventListener("click",a=>{a.preventDefault();let b,c=document.querySelector(".notes-topic p").innerText;for(let c of[...a.currentTarget.parentElement.children])if(c.classList.contains("note-name")){b=c.innerText;break}axios.post("/notes/deletenote",{topicName:c,entryName:b}),a.currentTarget.parentElement.remove()})}),editNote&&editNote.forEach(a=>{a.addEventListener("click",a=>{a.preventDefault();let b;for(let c of[...a.currentTarget.parentElement.children])if(c.classList.contains("note-name")){b=c.innerText;break}let c=Array.from(a.currentTarget.parentElement.children);c.splice(0,4);let d="";c.forEach(a=>{d+=a.innerHTML});let e=document.querySelector(".notes-topic p").innerText,f=document.querySelector(".text-notes-form"),g=document.createElement("form");g.setAttribute("method","post"),g.setAttribute("action",window.location.pathname),g.classList.add("text-notes-form");let h=document.createElement("input");h.setAttribute("name","topic-name"),h.setAttribute("required","true"),h.value=e,h.style.display="none";let i=document.createElement("input");i.setAttribute("name","old-entry-name"),i.setAttribute("required","true"),i.value=b,i.style.display="none";let j=document.createElement("div");j.classList.add("entry-name-container");let k=document.createElement("label");k.setAttribute("for","entry-name"),k.innerText="Entry name:",k.classList.add("entry-name-label");let l=document.createElement("input");l.setAttribute("name","entry-name"),l.setAttribute("required","true"),l.classList.add("entry-name"),l.value=b,j.append(k,l);let m=document.createElement("textarea");m.setAttribute("name","text-note-entry");let n=document.createElement("div");n.classList.add("text-notes-button-container");let o=document.createElement("button");o.classList.add("notes-cancel"),o.innerText="Cancel";let p=document.createElement("button");p.setAttribute("type","submit"),p.classList.add("notes-save"),p.innerText="Save",n.append(o,p),g.append(h,i,j,m,n),notesContainer.replaceChild(g,f),CKEDITOR.replace("text-note-entry"),CKEDITOR.instances["text-note-entry"].setData(d),window.scroll(g.offsetLeft,g.offsetTop),o.addEventListener("click",a=>{a.preventDefault();let b=document.createElement("form");b.setAttribute("method","post"),b.setAttribute("action",window.location.pathname),b.classList.add("text-notes-form"),notesContainer.replaceChild(b,g)}),p.addEventListener("click",()=>{l.value=removeWhitespace(l.value)})})}),audioPlayerContainers.forEach(a=>{let b,c,d,e,f,g,h,i=[];for(let b of a.children)if(i.push(b),0<b.children.length)for(let a of b.children)i.push(a);for(let j of i)switch(j.classList.value){case"audio__player":b=j;break;case"audio__seek-bar":c=j;break;case"audio__seek":d=j;break;case"current-time":e=j;break;case"duration":f=j;break;case"audio__play_pause":g=j;break;case"audio__stop":h=j;}isFinite(f)||(b.currentTime=1e4*Math.random(),f.innerText=convTime(b.duration)),g.addEventListener("click",()=>{b.paused?b.play():b.pause()}),h.addEventListener("click",()=>{b.paused||b.pause(),b.currentTime=0}),b.addEventListener("timeupdate",()=>{e.innerText=convTime(b.currentTime),f.innerText=convTime(b.duration),d.style.width=`${100*(b.currentTime/b.duration)}%`}),c.addEventListener("click",a=>{b.currentTime=a.offsetX/c.offsetWidth*b.duration})});
